<!doctype html><html lang=zh-cn><head><title>Mesa Driver Breaks VMWare ::
Horizon Blog Neo</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="新版本的 mesa 驱动与 VMWare 3D 加速的冲突 # 起因 # 昨天打开虚拟机中的 Fedora, 发现 进到 gdm 后直接黑屏, 鼠标移动到一些控件上的时候也许能显示出来. 同时 VMX 的 CPU 占用率一"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://horizonchaser.github.io/neo/posts/mesa-driver-breaks-vmware/><link rel=stylesheet href=/neo/css/style.css><link rel=stylesheet href=https://horizonchaser.github.io/neo/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://horizonchaser.github.io/neo/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://horizonchaser.github.io/neo/img/favicon.png><link href=/neo/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/neo/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/neo/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/neo/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/neo/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/neo/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary"><meta name=twitter:title content="Mesa Driver Breaks VMWare"><meta name=twitter:description content="新版本的 mesa 驱动和 VMWare 有冲突, 导致 3D 加速卡死 -- 降级可解"><meta property="og:title" content="Mesa Driver Breaks VMWare"><meta property="og:description" content="新版本的 mesa 驱动和 VMWare 有冲突, 导致 3D 加速卡死 -- 降级可解"><meta property="og:type" content="article"><meta property="og:url" content="https://horizonchaser.github.io/neo/posts/mesa-driver-breaks-vmware/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-02-25T11:24:25+08:00"><meta property="article:modified_time" content="2024-02-25T11:41:02+08:00"><meta property="og:site_name" content="Horizon Blog Neo"></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/neo class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>Horizon Blog Neo</span>
<span class=logo__cursor></span></a>
<span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/neo/index.xml>RSS</a></li><li><a href=/neo/about/>关于</a></li><li><a href=/neo/links/>友链</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/neo/index.xml>RSS</a></li><li><a href=/neo/about/>关于</a></li><li><a href=/neo/links/>友链</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><article class=post><h1 class=post-title>Mesa Driver Breaks VMWare</h1><div class=post-meta><time class=post-date>2024-02-25</time></div><span class=post-tags><a href=https://horizonchaser.github.io/neo/tags/linux/>#Linux</a>&nbsp;
<a href=https://horizonchaser.github.io/neo/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/>#虚拟机</a>&nbsp;
<a href=https://horizonchaser.github.io/neo/tags/debug/>#debug</a>&nbsp;</span><div class=post-content><h1 id=新版本的-mesa-驱动与-vmware-3d-加速的冲突>新版本的 mesa 驱动与 VMWare 3D 加速的冲突
<a href=#%e6%96%b0%e7%89%88%e6%9c%ac%e7%9a%84-mesa-%e9%a9%b1%e5%8a%a8%e4%b8%8e-vmware-3d-%e5%8a%a0%e9%80%9f%e7%9a%84%e5%86%b2%e7%aa%81 class=h-anchor aria-hidden=true>#</a></h1><h2 id=起因>起因
<a href=#%e8%b5%b7%e5%9b%a0 class=h-anchor aria-hidden=true>#</a></h2><p>昨天打开虚拟机中的 Fedora, 发现 进到 gdm 后直接黑屏, 鼠标移动到一些控件上的时候也许能显示出来. 同时 VMX 的 CPU 占用率一直在 ~20% 左右. 约几十秒后整个虚拟机卡死, 关闭时 VMWare 也会停止响应, 只能通过终止 VMX 退出. 查看事件查看器发现有大量的 LiveKernelEvent 141, <code>mksandbox</code> 崩溃.</p><p>一开始以为显卡或者显存出问题了, 跑了几轮 3DMark 下来也没发现啥; 把显卡驱动降级回 546.33 也没有什么改善. 显卡这边先排除了.</p><h2 id=经过>经过
<a href=#%e7%bb%8f%e8%bf%87 class=h-anchor aria-hidden=true>#</a></h2><p>折腾了半天打算重装系统的时候, 发现 VMWare 论坛上有一些人最近 (23年底) 也遇到了<a href=https://communities.vmware.com/t5/VMware-Workstation-Player/Linux-freezes-VMware-so-much-I-have-to-end-it-with-task-manager/td-p/3007215>同样的问题</a>, 表示是 6.5 及以上的新版内核或者新的 mesa 驱动导致的.</p><p>为了验证这点, 新开了一个 Debian 12.5 的虚拟机, 相关组件的版本都比较旧, 一切丝滑, 没任何问题&mldr;</p><h2 id=解决>解决
<a href=#%e8%a7%a3%e5%86%b3 class=h-anchor aria-hidden=true>#</a></h2><p>对于 Fedora 虚拟机:</p><ol><li>关闭 3D 加速, 进入系统, 此时会采用软件渲染</li><li>安装 <code>versionlock</code> 插件 (若无): <code>sudo dnf install 'dnf-command(versionlock)'</code></li><li>降级 mesa 驱动: <code>sudo dnf downgrade 'mesa*'</code></li><li>固定 mesa 版本: <code>sudo dnf versionlock add 'mesa*'</code>, 等新版本修好了再更新吧</li></ol><p>关闭虚拟机, 打开 3D 加速, 然后继续丝滑吧 (</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>阅读其它文章</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://horizonchaser.github.io/neo/posts/rvos/><span class=button__icon>←</span>
<span class=button__text>RVOS 课后练习</span></a></span>
<span class="button next"><a href=https://horizonchaser.github.io/neo/posts/horios-part1/><span class=button__text>HoriOS Part01 -- 实现一个简单的 UEFI Shell 和 Bootloader</span>
<span class=button__icon>→</span></a></span></div></div><script src=https://giscus.app/client.js data-repo=HorizonChaser/neo data-repo-id=R_kgDOLDDwZQ data-category=Announcements data-category-id=DIC_kwDOLDDwZc4CcVGj data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></article></div><footer class=footer><div class=footer__inner><a href=/neo class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>Horizon Blog Neo</span>
<span class=logo__cursor></span></a><div class=copyright><span>© 2024 Powered by <a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span><a href=https://github.com/panr/hugo-theme-hello-friend target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div><div><span><center><a href="https://icp.gov.moe/?keyword=20243141" target=_blank>萌ICP备20243141号</a></center></span></div></footer><script type=text/javascript src=/neo/bundle.min.js></script></div></body></html>